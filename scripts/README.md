# Deployment Scripts

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –¥–µ–ø–ª–æ—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º –Ω–∞ VPS.

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### 1. `deploy.sh` ‚Äî –ü–æ–ª–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

–í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –±–æ—Ç–∞ –Ω–∞ —á–∏—Å—Ç—ã–π VPS.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
sudo bash scripts/deploy.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º—É (apt update && upgrade)
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Python 3.11, pip, git, —É—Ç–∏–ª–∏—Ç—ã
3. –ö–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ /opt/problem-solver-bot
4. –°–æ–∑–¥–∞—ë—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
5. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
6. –°–æ–∑–¥–∞—ë—Ç .env (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ)
7. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
8. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç systemd service
9. –ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ß–∏—Å—Ç—ã–π Ubuntu 24.04 VPS
- Root –¥–æ—Å—Ç—É–ø
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

---

### 2. `update.sh` ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞

–û–±–Ω–æ–≤–ª—è–µ—Ç –±–æ—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
sudo bash scripts/update.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±–æ—Ç–∞
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç `git pull origin main`
3. –û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ requirements.txt
4. –û–±–Ω–æ–≤–ª—è–µ—Ç systemd service (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è)
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞
6. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥
- –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

### 3. `backup.sh` ‚Äî –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞—ë—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
sudo bash scripts/backup.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –ö–æ–ø–∏—Ä—É–µ—Ç bot_database.db –≤ backups/
2. –î–æ–±–∞–≤–ª—è–µ—Ç –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ –∏–º—è —Ñ–∞–π–ª–∞
3. –£–¥–∞–ª—è–µ—Ç –±—ç–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±—ç–∫–∞–ø–æ–≤

**–§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏:**
```
bot_database_20250102_143025.db
```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (cron):**
```bash
# –ë—ç–∫–∞–ø –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00
sudo crontab -e
# –î–æ–±–∞–≤—å—Ç–µ:
0 3 * * * /opt/problem-solver-bot/scripts/backup.sh
```

---

### 4. `logs.sh` ‚Äî –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

–£–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –±–æ—Ç–∞.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
bash scripts/logs.sh
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏:**
1. **–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è** ‚Äî –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –ø–æ—Ç–æ–∫ –ª–æ–≥–æ–≤ (journalctl -f)
2. **–ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫** ‚Äî –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ–¥–∞–≤–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π
3. **–õ–æ–≥–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è** ‚Äî –≤—Å—ë —Å –Ω–∞—á–∞–ª–∞ –¥–Ω—è
4. **–ü–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å** ‚Äî —Å–æ–±—ã—Ç–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 –º–∏–Ω—É—Ç
5. **–ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫** ‚Äî —Ç–æ–ª—å–∫–æ ERROR, EXCEPTION, CRITICAL

**–ü—Ä—è–º—ã–µ –∫–æ–º–∞–Ω–¥—ã:**
```bash
# –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
sudo journalctl -u problem-solver-bot -f

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
sudo journalctl -u problem-solver-bot -n 100

# –ó–∞ —Å–µ–≥–æ–¥–Ω—è
sudo journalctl -u problem-solver-bot --since today

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
sudo journalctl -u problem-solver-bot | grep -i error
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π:

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ VPS (Ubuntu 24.04, 2GB RAM)
# 2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH
ssh root@YOUR_VPS_IP

# 3. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/YOUR_USERNAME/problem-solver-bot.git
cd problem-solver-bot

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
sudo bash scripts/deploy.sh

# 5. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ .env
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
# –ù–∞ VPS
cd /opt/problem-solver-bot
sudo bash scripts/update.sh
```

### –†–µ–≥—É–ª—è—Ä–Ω—ã–π –±—ç–∫–∞–ø:

```bash
# –†—É—á–Ω–æ–π –±—ç–∫–∞–ø
sudo bash scripts/backup.sh

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)
sudo crontab -e
# –î–æ–±–∞–≤—å—Ç–µ:
0 3 * * * /opt/problem-solver-bot/scripts/backup.sh
```

---

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–û–°**: Ubuntu 24.04 (–∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π Debian-based)
- **–ü—Ä–∞–≤–∞**: Root –∏–ª–∏ sudo –¥–æ—Å—Ç—É–ø
- **–ü–∞–º—è—Ç—å**: –ú–∏–Ω–∏–º—É–º 1 –ì–ë RAM (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2 –ì–ë)
- **–î–∏—Å–∫**: –ú–∏–Ω–∏–º—É–º 5 –ì–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### URL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–í `deploy.sh` –∑–∞–º–µ–Ω–∏—Ç–µ URL –Ω–∞ –≤–∞—à:
```bash
REPO_URL="https://github.com/YOUR_USERNAME/problem-solver-bot.git"
```

### –ü—É—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–æ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `/opt/problem-solver-bot`.
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `INSTALL_DIR` –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫—Ä–∏–ø—Ç `deploy.sh` –ø–æ–ø—Ä–æ—Å–∏—Ç —Å–æ–∑–¥–∞—Ç—å `.env` —Ñ–∞–π–ª.
–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
- `CLAUDE_API_KEY` ‚Äî –∫–ª—é—á –æ—Ç console.anthropic.com
- `DATABASE_URL` ‚Äî –ø—É—Ç—å –∫ –ë–î (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é SQLite)
- `ENVIRONMENT` ‚Äî production

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –°–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞
ls -la scripts/
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: -rwxr-xr-x

# –ï—Å–ª–∏ –Ω–µ—Ç, —Å–¥–µ–ª–∞–π—Ç–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x scripts/*.sh
```

### –û—à–∏–±–∫–∞ "command not found"

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ bash —è–≤–Ω–æ
bash scripts/deploy.sh
# –∏–ª–∏
sudo bash scripts/update.sh
```

### Git pull –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
cd /opt/problem-solver-bot
git stash

# –û–±–Ω–æ–≤–∏—Ç–µ
sudo bash scripts/update.sh

# –í–µ—Ä–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
git stash pop
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é: [DEPLOYMENT.md](../DEPLOYMENT.md)

–í–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: https://t.me/andrejtsibin
