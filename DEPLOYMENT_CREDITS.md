# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### 1. **–ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (User)**
- ‚ùå –£–¥–∞–ª–µ–Ω–æ: `is_premium`, `free_problems_left`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ:
  - `problems_remaining` ‚Äî –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ —Ä–µ—à–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)
  - `discussion_credits` ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è
  - `last_purchased_package` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫—É–ø–ª–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç ('starter', 'medium', 'large')

### 2. **–ü–∞–∫–µ—Ç—ã —Ä–µ—à–µ–Ω–∏–π**

| –ü–∞–∫–µ—Ç | –†–µ—à–µ–Ω–∏–π | –¶–µ–Ω–∞ | –ë–∞–∑–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏–∏ |
|-------|---------|------|-------------------------------|
| **Starter** | 5 | 100‚≠ê (~$2) | 3 |
| **Medium** | 15 | 250‚≠ê (~$5) | 5 |
| **Large** | 50 | 700‚≠ê (~$14) | 10 |

### 3. **–ü–∞–∫–µ—Ç—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è**

| –ü–∞–∫–µ—Ç | –í–æ–ø—Ä–æ—Å–æ–≤ | –¶–µ–Ω–∞ |
|-------|----------|------|
| –ú–∞–ª—ã–π | 5 | 50‚≠ê (~$1) |
| –°—Ä–µ–¥–Ω–∏–π | 15 | 120‚≠ê (~$2.4) |

### 4. **–°–∏—Å—Ç–µ–º–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–π**

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
- –ó–∞–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–ª–∏–º–∏—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫—É–ø–ª–µ–Ω–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞)
- –ö—É–ø–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é (—Ç—Ä–∞—Ç–∏—Ç 1 –∫—Ä–µ–¥–∏—Ç —Ä–µ—à–µ–Ω–∏—è)

**–õ–æ–≥–∏–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤:**
- –ë–∞–∑–æ–≤—ã–π –ª–∏–º–∏—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ `last_purchased_package`
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏–∑ `discussion_credits`

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### –®–∞–≥ 1: –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ù–∞ VPS –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
cd /opt/problem-solver-bot  # –∏–ª–∏ –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
source venv/bin/activate
python3 migrate_to_credits.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å `is_premium=True` –ø–æ–ª—É—á–∞—Ç 50 –∫—Ä–µ–¥–∏—Ç–æ–≤ (Large –ø–∞–∫–µ—Ç)
- –°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å `free_problems_left=N` –ø–æ–ª—É—á–∞—Ç N –∫—Ä–µ–¥–∏—Ç–æ–≤
- –°–æ–∑–¥–∞—Å—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `users_backup_old_schema`

### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

```bash
git pull origin main
pip install -r requirements.txt  # –µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
# –ù–∞ VPS —á–µ—Ä–µ–∑ systemd
sudo systemctl restart problem-solver-bot
sudo systemctl status problem-solver-bot

# –õ–æ–∫–∞–ª—å–Ω–æ
python -m bot.main
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞:**
   - –û—Ç–ø—Ä–∞–≤—å `/start`
   - –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è: "–î–æ—Å—Ç—É–ø–Ω–æ —Ä–µ—à–µ–Ω–∏–π: N", "–î–æ—Å—Ç—É–ø–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: M"

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—É–ø–∫–∏:**
   - –ù–∞–∂–º–∏ "üí≥ –ö—É–ø–∏—Ç—å —Ä–µ—à–µ–Ω–∏—è"
   - –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è 3 –ø–∞–∫–µ—Ç–∞ —Ä–µ—à–µ–Ω–∏–π + –∫–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã"

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏—è:**
   - –†–µ—à–∏ –ø—Ä–æ–±–ª–µ–º—É –¥–æ –∫–æ–Ω—Ü–∞
   - –ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–Ω–æ–ø–∫–∞ "üí¨ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ"
   - –ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Å—á—ë—Ç—á–∏–∫ "–í–æ–ø—Ä–æ—Å–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å: X/Y"

## –û—Ç–∫–∞—Ç –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
cd /opt/problem-solver-bot
sqlite3 bot_database.db

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
DROP TABLE users;
ALTER TABLE users_backup_old_schema RENAME TO users;
.quit

# –û—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–¥
git checkout <previous-commit-hash>
sudo systemctl restart problem-solver-bot
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
sqlite3 bot_database.db "SELECT telegram_id, problems_remaining, discussion_credits, last_purchased_package FROM users;"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–ª–∞—Ç–µ–∂–∏
sqlite3 bot_database.db "SELECT user_id, amount, currency, status, created_at FROM payments ORDER BY created_at DESC LIMIT 10;"
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ bot/handlers/

### start.py
- –û–±–Ω–æ–≤–ª—ë–Ω —Ç–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–µ–¥–∏—Ç—ã –≤–º–µ—Å—Ç–æ –ø—Ä–µ–º–∏—É–º-—Å—Ç–∞—Ç—É—Å–∞)
- –ö–Ω–æ–ø–∫–∞ "üíé –ü—Ä–µ–º–∏—É–º" ‚Üí "üí≥ –ö—É–ø–∏—Ç—å —Ä–µ—à–µ–Ω–∏—è"

### payment.py
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –ø–æ–¥ —Å–∏—Å—Ç–µ–º—É –ø–∞–∫–µ—Ç–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è 5 —Ç–∏–ø–æ–≤ –ø–æ–∫—É–ø–æ–∫ (3 –ø–∞–∫–µ—Ç–∞ —Ä–µ—à–µ–Ω–∏–π + 2 –ø–∞–∫–µ—Ç–∞ –≤–æ–ø—Ä–æ—Å–æ–≤)

### problem_flow.py
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ —Å `is_premium / free_problems_left` –Ω–∞ `problems_remaining`
- –î–æ–±–∞–≤–ª–µ–Ω —Ä–µ–∂–∏–º –æ–±—Å—É–∂–¥–µ–Ω–∏—è (`discussing_solution` state)
- –ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è "üí¨ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ"

### states.py
- –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: `discussing_solution`

### crud.py
- –§—É–Ω–∫—Ü–∏—è `update_user_premium()` ‚Üí `update_user_credits()`

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π:
1. **–ö–æ–Ω–≤–µ—Ä—Å–∏—é –≤ –ø–æ–∫—É–ø–∫—É** ‚Äî —Å–∫–æ–ª—å–∫–æ —é–∑–µ—Ä–æ–≤ –ø–æ–∫—É–ø–∞—é—Ç –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∫—Ä–µ–¥–∏—Ç–∞
2. **–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –ø–∞–∫–µ—Ç–æ–≤** ‚Äî –∫–∞–∫–æ–π –ø–∞–∫–µ—Ç —á–∞—â–µ –≤—Å–µ–≥–æ –ø–æ–∫—É–ø–∞—é—Ç
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—Å—É–∂–¥–µ–Ω–∏–π** ‚Äî –∑–∞–¥–∞—é—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
4. **–û—Ç—Ç–æ–∫** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—É–ø–æ–∫
SELECT
    CASE
        WHEN payload LIKE 'starter%' THEN 'Starter'
        WHEN payload LIKE 'medium%' THEN 'Medium'
        WHEN payload LIKE 'large%' THEN 'Large'
        WHEN payload LIKE 'discussion%' THEN 'Discussions'
    END as package_type,
    COUNT(*) as purchases,
    SUM(amount) as total_revenue
FROM payments
WHERE status = 'completed'
GROUP BY package_type;
```

## FAQ

**Q: –ß—Ç–æ –±—É–¥–µ—Ç —Å —Ç–µ–∫—É—â–∏–º–∏ –ø—Ä–µ–º–∏—É–º-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏?**
A: –û–Ω–∏ –ø–æ–ª—É—á–∞—Ç 50 –∫—Ä–µ–¥–∏—Ç–æ–≤ (—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç Large –ø–∞–∫–µ—Ç–∞) + –ø–∞–∫–µ—Ç 'large' –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.

**Q: –°–≥–æ—Ä–∞—é—Ç –ª–∏ –∫—Ä–µ–¥–∏—Ç—ã?**
A: –ù–µ—Ç, –≤—Å–µ –∫—Ä–µ–¥–∏—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∫—É–ø–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞–∫–µ—Ç–æ–≤ –ø–æ–¥—Ä—è–¥?**
A: –î–∞, –∫—Ä–µ–¥–∏—Ç—ã —Å—É–º–º–∏—Ä—É—é—Ç—Å—è.

**Q: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏–∏?**
A: –°–Ω–∞—á–∞–ª–∞ —Ç—Ä–∞—Ç—è—Ç—Å—è –±–∞–∑–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–∏–∑ –ø–∞–∫–µ—Ç–∞), –ø–æ—Ç–æ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ (`discussion_credits`).
